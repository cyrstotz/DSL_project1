x Q double arrow phi equals phi f plus x times (phi g minus phi f).  
S equals S f plus x times (S g minus S f).  
S 1 equals S f.  
State 3 and state 4 are just condensed,  
TAB A7.